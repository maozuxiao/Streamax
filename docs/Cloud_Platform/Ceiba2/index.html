<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ceiba2 - Streamax知识库</title>
    <link rel="icon" href="https://www.streamax.com/static/en/img/favicon.ico" type="image/x-icon">
    <!-- 引入Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Ceiba2云平台</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../../index.html">首页</a></li>
                <li class="breadcrumb-item"><a href="../index.html">云平台</a></li>
                <li class="breadcrumb-item active" aria-current="page">Ceiba2</li>
            </ol>
        </nav>
        
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Ceiba2概述</h5>
                <p class="card-text">Ceiba2是Streamax推出的新一代云平台，采用微服务架构设计，具有高性能、高可靠性和高扩展性，为用户提供全方位的车辆管理和监控解决方案。</p>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">核心功能</h5>
                <ul>
                    <li>实时视频监控：支持多通道视频查看、回放和下载</li>
                    <li>车辆定位跟踪：实时掌握车辆位置、速度和行驶轨迹</li>
                    <li>告警管理：智能识别和处理各种异常情况，如超速、偏离路线等</li>
                    <li>数据分析：提供丰富的数据统计和分析报告，支持自定义报表</li>
                    <li>设备管理：远程管理和配置设备，支持固件升级</li>
                    <li>用户管理：多级权限控制，支持角色定制</li>
                    <li>API接口：提供丰富的API接口，支持第三方系统集成</li>
                </ul>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">技术特点</h5>
                <ul>
                    <li>微服务架构：模块化设计，易于扩展和维护</li>
                    <li>高可用性：多节点部署，自动故障转移</li>
                    <li>高性能：支持大规模并发访问</li>
                    <li>安全性：采用多重加密技术，保障数据安全</li>
                    <li>灵活性：支持私有云、公有云和混合云部署</li>
                    <li>易用性：直观的Web界面，操作简单便捷</li>
                </ul>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">应用场景</h5>
                <ul>
                    <li>公共交通：公交、地铁、轻轨等</li>
                    <li>货运物流：货车、危险品运输车等</li>
                    <li>出租车：巡游出租车、网约车等</li>
                    <li>校车：中小学、幼儿园校车</li>
                    <li>警用车辆：警车、执法车等</li>
                    <li>工程机械：挖掘机、装载机等</li>
                </ul>
            </div>
        </div>
        
        <!-- 文件列表模块 -->
        <div class="mb-3">
            <input type="text" id="search-box" class="form-control" placeholder="搜索文件...">
        </div>
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">文件列表</h5>
            </div>
            <div class="card-body">
                <ul id="file-list" class="list-group list-group-flush">
                    <!-- 文件列表将通过JavaScript动态生成 -->
                </ul>
            </div>
        </div>
        
        <footer class="mt-5 pt-4 border-top">
            <p class="text-muted">© Sean | Streamax Knowledge Base</p>
        </footer>
    </div>
    
    <!-- 引入Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // GitHub API 配置
        const repoOwner = 'maozuxiao';
        const repoName = 'Streamax';
        const branch = 'main';
        
        // 获取当前目录路径，确定API请求路径
        const currentPath = window.location.pathname;
        
        // GitHub Pages URL结构：https://username.github.io/repoName/directory/file.html
        // 提取目录路径，考虑到GitHub Pages将docs目录作为根目录
        let apiPath = 'docs';
        
        // 分割路径
        const parts = currentPath.split('/');
        const repoIndex = parts.indexOf(repoName);
        
        // 确定是否为根目录
        let isRoot = true;
        let currentDir = '';
        
        if (repoIndex !== -1 && parts.length > repoIndex + 2) {
            // 提取repoName后的目录路径
            // parts = ['', 'repoName', 'directory', 'file.html']
            const subPath = parts.slice(repoIndex + 1, -1).join('/'); // 移除文件名，保留目录路径
            apiPath = `docs/${subPath}`;
            isRoot = false;
            currentDir = subPath + '/';
        } else if (repoIndex !== -1 && parts.length === repoIndex + 2) {
            // 根目录情况：https://username.github.io/repoName/
            apiPath = 'docs';
            isRoot = true;
            currentDir = '';
        }
        
        // 获取文件列表容器
        const fileList = document.getElementById('file-list');
        
        // 使用GitHub API获取文件列表
        fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${apiPath}?ref=${branch}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`GitHub API 请求失败: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // 清空文件列表
                fileList.innerHTML = '';
                
                // 支持的文件格式
                const supportedFormats = ['.pdf', '.md', '.markdown', '.html'];
                
                // 要排除的文件
                const excludedFiles = ['index.html', 'readme.md', 'markdown-viewer.html'];
                
                // 分离目录和文件
                const folders = data.filter(item => item.type === 'dir');
                const files = data.filter(item => 
                    item.type === 'file' && 
                    supportedFormats.includes('.' + item.name.split('.').pop().toLowerCase()) && 
                    !excludedFiles.includes(item.name.toLowerCase())
                );
                
                // 先添加目录，再添加文件
                folders.forEach(folder => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item file-item';
                    listItem.setAttribute('data-file-name', folder.name.toLowerCase());
                    
                    const icon = document.createElement('span');
                    icon.className = 'icon me-2';
                    icon.textContent = '📁';
                    
                    const link = document.createElement('a');
                    link.href = `${folder.name}/index.html`;
                    link.textContent = folder.name;
                    link.className = 'text-decoration-none';
                    link.target = '_self';
                    
                    listItem.appendChild(icon);
                    listItem.appendChild(link);
                    fileList.appendChild(listItem);
                });
                
                // 添加文件
                files.forEach(file => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item file-item';
                    listItem.setAttribute('data-file-name', file.name.toLowerCase());
                    
                    const icon = document.createElement('span');
                    icon.className = 'icon me-2';
                    
                    // 根据文件类型设置不同图标
                    if (file.name.endsWith('.html')) {
                        icon.textContent = '🌐';
                    } else if (file.name.endsWith('.pdf')) {
                        icon.textContent = '📄';
                    } else if (file.name.endsWith('.md') || file.name.endsWith('.markdown')) {
                        icon.textContent = '📝';
                    }
                    
                    const link = document.createElement('a');
                    link.className = 'text-decoration-none';
                    
                    // 构建文件链接
                    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                    if (fileExtension === '.md' || fileExtension === '.markdown') {
                        // MD文件使用markdown-viewer.html
                        // 确保生成的路径正确，不包含多余的docs/前缀
                        let filePath = file.path;
                        // 从file.path中提取docs/后面的路径
                        // file.path格式：docs/filename.md 或 docs/subdir/filename.md
                        if (filePath.startsWith('docs/')) {
                            filePath = filePath.slice(5); // 移除docs/前缀
                        }
                        link.href = `../../markdown-viewer.html?file=${encodeURIComponent(filePath)}`;
                    } else {
                        // HTML和PDF文件直接打开
                        link.href = file.name;
                    }
                    
                    link.textContent = file.name;
                    
                    listItem.appendChild(icon);
                    listItem.appendChild(link);
                    fileList.appendChild(listItem);
                });
                
                // 如果没有文件，显示提示信息
                if (folders.length === 0 && files.length === 0) {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item text-muted';
                    listItem.textContent = '当前目录下没有支持的文件';
                    fileList.appendChild(listItem);
                }
            })
            .catch(error => {
                console.error('Error fetching files:', error);
                // 如果API调用失败，显示错误信息
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item text-danger';
                listItem.textContent = `无法获取文件列表: ${error.message}`;
                fileList.appendChild(listItem);
            });

            // 添加搜索功能
            function filterFiles() {
                const searchInput = document.getElementById("search-box").value.toLowerCase();
                const fileItems = document.querySelectorAll(".file-item");

                fileItems.forEach(item => {
                    const fileName = item.getAttribute("data-file-name");
                    if (fileName && fileName.includes(searchInput)) {
                        item.style.display = "flex";
                    } else {
                        item.style.display = "none";
                    }
                });
            }

            document.getElementById("search-box").addEventListener("input", filterFiles);
    </script>
</body>
</html>